## 计算机组成原理 - 数据通路设计

### 计14 涂珂2011011273，计14 傅左右 2011011264
### \today


### 数据通路图如下：

![初步、简单的设计图](datapath.jpg)

### 方案选择

我们选择的实验为流水线实验。（在此图中没有加入对冲突的处理）
根据4个流水线寄存器（图中最大的矩形）将流水线分为5个部分：

1.	IF：取指令
2.	ID: 指令译码，读寄存器堆
3.	Ex: 指令执行，地址计算
4.	MEM： 数据内存访问
5.	WB： 写回

指令和数据随执行过程从左到右依次从五个过程走过。每个时钟周期5个部分并行处理不同指令的对应部分。

### 每条指令对数据通路的操作

1. IF 取指令，PC从内存中取指令，并将数据放入IF/ID寄存器。将PC中地址+4取下一条指令，但也可能会有跳转指令，所以有一个数据选择器选择。
2. ID指令译码，其将数据存入2个读寄存器（可能只用一个，由指令决定）， 有的指令有立即数的输入，这里提供了一个符号扩展单元。将扩展后的数以及2个寄存器中数据，还有增加后的PC值写入ID/EX寄存器。
3. EX 将立即数左移两位进行加法运算，根据指令类型进行不同的ALU运算，结果放入EX/MEM寄存器。
4. MEM 根据得到的结果读取数据内存。写入MEM/WB寄存器。
5. WB 将得到的写入寄存器堆中。

### 指令设计

指令设计：

 - 用前5位表示op。共30条。
 - 加*为扩展指令。
 - XXX，YYY，ZZZ为寄存器标号。
 - III为立即数。

把类型相近的op连续起来，这样写代码就可以用大于小于判断了。

**R型指令**

R		指令结构
----	----------------
MFIH	00001XXX00000000
MFPC	00010XXX00000000
MTIH	00011XXX00000000
MTSP	00100XXX00000000
AND		00101XXXYYY00000
OR		00110XXXYYY00000
*NOT	00111XXXYYY00000
*SLT	01000XXXYYY00000
CMP		01001XXXYYY00000
SLL		01010XXXYYYIII00
SRA		01011XXXYYYIII00
ADDU	01100XXXYYYZZZ00
SUBU	01101XXXYYYZZZ00

**I型指令**

I		指令结构
-----	----------------
ADDSP	01110IIIIIIII000
LW_SP	01111XXX00000000
ADDIU	10000XXXIIIIIIII
*SLTI	10001XXXIIIIIIII
*ADDSP3	10010XXXIIIIIIII
LI		10011XXXIIIIIIII
ADDIU3	10100XXXYYY0IIII
LW		10101XXXYYYIIIII
SW		10110XXXYYYIIIII
SW_SP	10111XXXYYYIIIII

**B型指令**

B		指令结构
-----	----------------
B		11000IIIIIIIIIII
BTEQZ	11001IIIIIIII000
BEQZ	11010XXXIIIIIIII
BNEZ	11011XXXIIIIIIII

**J型指令**

J		指令结构
-----	----------------
*JRRA	1110000000000000
JR		11101XXX00000000

**NOP指令**

-----	----------------
NOP		0000000000000000
-----	----------------
